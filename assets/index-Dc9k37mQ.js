function O(e,n,t,i){const a=e/n,r=t/i;if(r>a){const c=e/r,d=(n-c)/2;return{sw:e,sh:c,sx:0,sy:d}}const s=n*r,o=(e-s)/2;return{sh:n,sw:s,sx:o,sy:0}}let f,h=null;function D(){return(h===null||h.byteLength===0)&&(h=new Uint8Array(f.memory.buffer)),h}let x=0;function N(e,n){const t=n(e.length*1,1)>>>0;return D().set(e,t/1),x=e.length,t}let y=null;function T(){return(y===null||y.byteLength===0)&&(y=new Int32Array(f.memory.buffer)),y}let b=null;function F(){return(b===null||b.byteLength===0)&&(b=new Uint8ClampedArray(f.memory.buffer)),b}function j(e,n){return e=e>>>0,F().subarray(e/1,e/1+n)}function K(e,n,t,i,a,r,s,o){try{const M=f.__wbindgen_add_to_stack_pointer(-16),z=N(e,f.__wbindgen_malloc),q=x;f.resize(M,z,q,n,t,i,a,r,s,o);var c=T()[M/4+0],d=T()[M/4+1],S=j(c,d).slice();return f.__wbindgen_free(c,d*1,1),S}finally{f.__wbindgen_add_to_stack_pointer(16)}}async function G(e,n){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,n)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,n)}else{const t=await WebAssembly.instantiate(e,n);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}function B(){const e={};return e.wbg={},e}function P(e,n){return f=e.exports,$.__wbindgen_wasm_module=n,y=null,h=null,b=null,f}async function $(e){if(f!==void 0)return f;typeof e>"u"&&(e=new URL("/assets/squoosh_resize_bg-YY9xfwUg.wasm",import.meta.url));const n=B();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:i}=await G(await e,n);return P(t,i)}const V=globalThis.ServiceWorkerGlobalScope!==void 0,H=V&&typeof self<"u"&&globalThis.caches&&globalThis.caches.default!==void 0,Y=typeof process=="object"&&process.release&&process.release.name==="node";(H||Y)&&(globalThis.ImageData||(globalThis.ImageData=class{constructor(n,t,i){this.data=n,this.width=t,this.height=i}}),import.meta.url===void 0&&(import.meta.url="https://localhost"),typeof self<"u"&&self.location===void 0&&(self.location={href:""}));let u,m=null;function v(){return(m===null||m.byteLength===0)&&(m=new Uint32Array(u.memory.buffer)),m}let E=0;function X(e,n){const t=n(e.length*4,4)>>>0;return v().set(e,t/4),E=e.length,t}let g=null;function C(){return(g===null||g.byteLength===0)&&(g=new Int32Array(u.memory.buffer)),g}function J(e,n){return e=e>>>0,v().subarray(e/4,e/4+n)}function Q(e,n,t,i){try{const o=u.__wbindgen_add_to_stack_pointer(-16),c=X(e,u.__wbindgen_malloc),d=E;u.resize(o,c,d,n,t,i);var a=C()[o/4+0],r=C()[o/4+1],s=J(a,r).slice();return u.__wbindgen_free(a,r*4,4),s}finally{u.__wbindgen_add_to_stack_pointer(16)}}async function Z(e,n){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,n)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,n)}else{const t=await WebAssembly.instantiate(e,n);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}function ee(){const e={};return e.wbg={},e}function te(e,n){return u=e.exports,L.__wbindgen_wasm_module=n,g=null,m=null,u}async function L(e){if(u!==void 0)return u;typeof e>"u"&&(e=new URL("/assets/squooshhqx_bg-jpRtGvMp.wasm",import.meta.url));const n=ee();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:i}=await Z(await e,n);return te(t,i)}const ne=globalThis.ServiceWorkerGlobalScope!==void 0,ie=ne&&typeof self<"u"&&globalThis.caches&&globalThis.caches.default!==void 0,se=typeof process=="object"&&process.release&&process.release.name==="node";(ie||se)&&(globalThis.ImageData||(globalThis.ImageData=class{constructor(n,t,i){this.data=n,this.width=t,this.height=i}}),import.meta.url===void 0&&(import.meta.url="https://localhost"),typeof self<"u"&&self.location===void 0&&(self.location={href:""}));let l;function ae(e,n){return e=e>>>0,re().subarray(e/1,e/1+n)}let w=null;function W(){return(w===null||w.byteLength===0)&&(w=new Uint8Array(l.memory.buffer)),w}let _=null;function re(){return(_===null||_.byteLength===0)&&(_=new Uint8ClampedArray(l.memory.buffer)),_}function oe(e,n){const t=n(e.length*1,1)>>>0;return W().set(e,t/1),A=e.length,t}function ce(e,n,t){if(t===void 0){const o=p.encode(e),c=n(o.length,1)>>>0;return W().subarray(c,c+o.length).set(o),A=o.length,c}let i=e.length,a=n(i,1)>>>0;const r=W();let s=0;for(;s<i;s++){const o=e.charCodeAt(s);if(o>127)break;r[a+s]=o}if(s!==i){s!==0&&(e=e.slice(s)),a=t(a,i,i=s+e.length*3,1)>>>0;const o=W().subarray(a+s,a+i),c=p.encodeInto(e,o);s+=c.written,a=t(a,i,s,1)>>>0}return A=s,a}const p=new TextEncoder;"encodeInto"in p||(p.encodeInto=function(e,n){const t=p.encode(e);return n.set(t),{read:e.length,written:t.length}});let A=0;function le(e,n,t,i,a,r){const s=oe(e,l.__wbindgen_malloc),o=A,c=ce(r,l.__wbindgen_malloc,l.__wbindgen_realloc),d=A;return l.resize(s,o,n,t,i,a,c,d)}const fe=new Set(["basic","cors","default"]);async function ue(e,n){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,n)}catch(i){if(e.ok&&fe.has(e.type)&&e.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,n)}else{const t=await WebAssembly.instantiate(e,n);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}function de(){const e={};return e.wbg={},e.wbg.__wbg_new_with_owned_u8_clamped_array_and_sh_e8143e95833a3ec3=function(n,t,i,a){var r=ae(n,t).slice();return l.__wbindgen_free(n,t*1,1),new ImageData(r,i>>>0,a>>>0)},e.wbg.__wbindgen_init_externref_table=function(){const n=l.__wbindgen_externrefs,t=n.grow(4);n.set(0,void 0),n.set(t+0,void 0),n.set(t+1,null),n.set(t+2,!0),n.set(t+3,!1)},e}function he(e,n){return l=e.exports,k.__wbindgen_wasm_module=n,w=null,_=null,l.__wbindgen_start(),l}async function k(e){if(l!==void 0)return l;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL("/assets/jsquash_magic_kernel_bg-Cq4C4bH5.wasm",import.meta.url));const n=de();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:i}=await ue(await e,n);return he(t,i)}const ye=globalThis.ServiceWorkerGlobalScope!==void 0,be=ye&&typeof self<"u"&&globalThis.caches&&globalThis.caches.default!==void 0,me=typeof process=="object"&&process.release&&process.release.name==="node";(be||me)&&(globalThis.ImageData||(globalThis.ImageData=class{constructor(n,t,i){this.data=n,this.width=t,this.height=i}}),import.meta.url===void 0&&(import.meta.url="https://localhost"),typeof self<"u"&&self.location===void 0&&(self.location={href:""}));const ge={width:1,height:1,method:"lanczos3",fitMethod:"stretch",premultiply:!0,linearRGB:!0},we=["magicKernel","magicKernelSharp2013","magicKernelSharp2021"];let R,I,U;function _e(e){return R||(R=$(e)),R}function pe(e){return I||(I=L(e)),I}function Ae(e){return U||(U=k(e)),U}function We(e){return e.method==="hqx"}function Re(e){return we.includes(e.method)}function Me(e,n,t,i,a){const r=new Uint32Array(e.data.buffer);for(let s=0;s<a;s+=1){const o=(s+t)*e.width+n;r.copyWithin(s*i,o,o+i)}return new ImageData(new Uint8ClampedArray(r.buffer.slice(0,i*a*4)),i,a)}function Ie(e,{min:n=Number.MIN_VALUE,max:t=Number.MAX_VALUE}){return Math.min(Math.max(e,n),t)}const Ue=["triangle","catrom","mitchell","lanczos3"];async function Se(e,n){await pe();const t=n.width/e.width,i=n.height/e.height,a=Math.max(t,i),r=Ie(Math.ceil(a),{min:1,max:4});if(r===1)return e;const s=Q(new Uint32Array(e.data.buffer),e.width,e.height,r);return new ImageData(new Uint8ClampedArray(s.buffer),e.width*r,e.height*r)}async function Te(e,n){return await Ae(),le(new Uint8Array(e.data.buffer),e.width,e.height,n.width,n.height,n.method)}async function ve(e,n){let t={...ge,...n},i=e;if(_e(),We(t)&&(i=await Se(i,t),t={...t,method:"catrom"}),await R,t.fitMethod==="contain"){const{sx:r,sy:s,sw:o,sh:c}=O(e.width,e.height,t.width,t.height);i=Me(i,Math.round(r),Math.round(s),Math.round(o),Math.round(c))}if(Re(t))return Te(i,t);const a=K(new Uint8Array(i.data.buffer),i.width,i.height,t.width,t.height,Ue.indexOf(t.method),t.premultiply,t.linearRGB);return new ImageData(new Uint8ClampedArray(a.buffer),t.width,t.height)}export{ve as default,pe as initHqx,Ae as initMagicKernel,_e as initResize};
